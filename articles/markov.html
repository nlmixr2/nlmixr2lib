<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Markov modeling • nlmixr2lib</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Markov modeling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nlmixr2lib</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/create-model-library.html">Creating a model library</a></li>
    <li><a class="dropdown-item" href="../articles/Grimm_2023.html">Trontinemab and gantenerumab PK in plasma and brain (Grimm 2023)</a></li>
    <li><a class="dropdown-item" href="../articles/Kyhl_2016_nalmefene.html">Kyhl_2016_nalmefene</a></li>
    <li><a class="dropdown-item" href="../articles/list-of-models.html">List of models</a></li>
    <li><a class="dropdown-item" href="../articles/markov.html">Markov modeling</a></li>
    <li><a class="dropdown-item" href="../articles/Xie_2019_agomelatine.html">Xie_2019_agomelatine</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nlmixr2/nlmixr2lib/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Markov modeling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/nlmixr2lib/blob/main/vignettes/markov.Rmd" class="external-link"><code>vignettes/markov.Rmd</code></a></small>
      <div class="d-none name"><code>markov.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nlmixr2/nlmixr2lib" class="external-link">nlmixr2lib</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="create-your-dataset">Create your dataset<a class="anchor" aria-label="anchor" href="#create-your-dataset"></a>
</h2>
<p>Start from an initial dataset that has a previous state and a current
state column. For this exercise, we will use a hypothetical adverse
event profile switching between “none”, “mild”, and “moderate”
severities.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dMarkov</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      ID <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      TIME <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>      previous <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"mild"</span>, <span class="st">"moderate"</span>, <span class="st">"mild"</span>, <span class="st">"mild"</span><span class="op">)</span>,</span>
<span>      current <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mild"</span>, <span class="st">"moderate"</span>, <span class="st">"mild"</span>, <span class="st">"mild"</span>, <span class="st">"none"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      ID <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      TIME <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>      previous <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"moderate"</span>, <span class="st">"moderate"</span>, <span class="st">"none"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>      current <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"moderate"</span>, <span class="st">"moderate"</span>, <span class="st">"none"</span>, <span class="st">"none"</span>, <span class="st">"none"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      ID <span class="op">=</span> <span class="fl">3</span>,</span>
<span>      TIME <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>      previous <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"mild"</span>, <span class="st">"mild"</span>, <span class="st">"mild"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>      current <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"mild"</span>, <span class="st">"mild"</span>, <span class="st">"none"</span>, <span class="st">"mild"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>To make interpretability easier later, put the states in order, if
they are not numeric. Putting the levels in order is not required, but
if not done, then they will be sorted alphabetically in the modeling
which may not make sense (e.g. “none” coming after “moderate”).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stateLevels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"mild"</span>, <span class="st">"moderate"</span><span class="op">)</span></span>
<span><span class="va">dMarkov</span><span class="op">$</span><span class="va">previous</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dMarkov</span><span class="op">$</span><span class="va">previous</span>, levels <span class="op">=</span> <span class="va">stateLevels</span><span class="op">)</span></span>
<span><span class="va">dMarkov</span><span class="op">$</span><span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dMarkov</span><span class="op">$</span><span class="va">current</span>, levels <span class="op">=</span> <span class="va">stateLevels</span><span class="op">)</span></span></code></pre></div>
<p>The dataset for estimation requires one-hot encoded columns in the
dataset. That more simply means we need columns set to 1 for when a
Markov state applies and 0 when it does not.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dMarkov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMarkovModelDataset.html">createMarkovModelDataset</a></span><span class="op">(</span><span class="va">dMarkov</span>, colPrev <span class="op">=</span> <span class="st">"previous"</span>, colCur <span class="op">=</span> <span class="st">"current"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_print.html" class="external-link">knit_print</a></span><span class="op">(</span><span class="va">dMarkov</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ID TIME previous  current prevnone curnone prevmild curmild prevmoderate</span></span>
<span><span class="co">#&gt; 1   1    0     none     mild     TRUE   FALSE    FALSE    TRUE        FALSE</span></span>
<span><span class="co">#&gt; 2   1    1     mild moderate    FALSE   FALSE     TRUE   FALSE        FALSE</span></span>
<span><span class="co">#&gt; 3   1    2 moderate     mild    FALSE   FALSE    FALSE    TRUE         TRUE</span></span>
<span><span class="co">#&gt; 4   1    3     mild     mild    FALSE   FALSE     TRUE    TRUE        FALSE</span></span>
<span><span class="co">#&gt; 5   1    4     mild     none    FALSE    TRUE     TRUE   FALSE        FALSE</span></span>
<span><span class="co">#&gt; 6   2    0     none moderate     TRUE   FALSE    FALSE   FALSE        FALSE</span></span>
<span><span class="co">#&gt; 7   2    1 moderate moderate    FALSE   FALSE    FALSE   FALSE         TRUE</span></span>
<span><span class="co">#&gt; 8   2    2 moderate     none    FALSE    TRUE    FALSE   FALSE         TRUE</span></span>
<span><span class="co">#&gt; 9   2    3     none     none     TRUE    TRUE    FALSE   FALSE        FALSE</span></span>
<span><span class="co">#&gt; 10  2    4     none     none     TRUE    TRUE    FALSE   FALSE        FALSE</span></span>
<span><span class="co">#&gt; 11  3    0     none     none     TRUE    TRUE    FALSE   FALSE        FALSE</span></span>
<span><span class="co">#&gt; 12  3    1     mild     mild    FALSE   FALSE     TRUE    TRUE        FALSE</span></span>
<span><span class="co">#&gt; 13  3    2     mild     mild    FALSE   FALSE     TRUE    TRUE        FALSE</span></span>
<span><span class="co">#&gt; 14  3    3     mild     none    FALSE    TRUE     TRUE   FALSE        FALSE</span></span>
<span><span class="co">#&gt; 15  3    4     none     mild     TRUE   FALSE    FALSE    TRUE        FALSE</span></span>
<span><span class="co">#&gt;    curmoderate</span></span>
<span><span class="co">#&gt; 1        FALSE</span></span>
<span><span class="co">#&gt; 2         TRUE</span></span>
<span><span class="co">#&gt; 3        FALSE</span></span>
<span><span class="co">#&gt; 4        FALSE</span></span>
<span><span class="co">#&gt; 5        FALSE</span></span>
<span><span class="co">#&gt; 6         TRUE</span></span>
<span><span class="co">#&gt; 7         TRUE</span></span>
<span><span class="co">#&gt; 8        FALSE</span></span>
<span><span class="co">#&gt; 9        FALSE</span></span>
<span><span class="co">#&gt; 10       FALSE</span></span>
<span><span class="co">#&gt; 11       FALSE</span></span>
<span><span class="co">#&gt; 12       FALSE</span></span>
<span><span class="co">#&gt; 13       FALSE</span></span>
<span><span class="co">#&gt; 14       FALSE</span></span>
<span><span class="co">#&gt; 15       FALSE</span></span></code></pre></div>
<p>A DV column is required for <code>nlmixr2</code> to work, but it will
be ignored for this model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dMarkov</span><span class="op">$</span><span class="va">DV</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-your-model">Create your model<a class="anchor" aria-label="anchor" href="#create-your-model"></a>
</h2>
<p>To automatically generate a Markov model structure from your data,
use the <code><a href="../reference/createMarkovModel.html">createMarkovModel()</a></code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMarkovModel.html">createMarkovModel</a></span><span class="op">(</span>colPrev <span class="op">=</span> <span class="va">dMarkov</span><span class="op">$</span><span class="va">previous</span>, colCur <span class="op">=</span> <span class="va">dMarkov</span><span class="op">$</span><span class="va">current</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; function() {</span></span>
<span><span class="co">#&gt;   markovStates &lt;- c(none = "none", mild = "mild", moderate = "moderate")</span></span>
<span><span class="co">#&gt;   ini({</span></span>
<span><span class="co">#&gt;     lnonetonone &lt;- -0.6931; label("Probability of transition from state none to none (log-link)")</span></span>
<span><span class="co">#&gt;     lnonetomild &lt;- 0.5108; label("Probability of transition from state none to mild (log-logit link difference from prior state)")</span></span>
<span><span class="co">#&gt;     lmildtonone &lt;- -1.099; label("Probability of transition from state mild to none (log-link)")</span></span>
<span><span class="co">#&gt;     lmildtomild &lt;- 0.9163; label("Probability of transition from state mild to mild (log-logit link difference from prior state)")</span></span>
<span><span class="co">#&gt;     lmoderatetonone &lt;- -1.099; label("Probability of transition from state moderate to none (log-link)")</span></span>
<span><span class="co">#&gt;     lmoderatetomild &lt;- 0.6931; label("Probability of transition from state moderate to mild (log-logit link difference from prior state)")</span></span>
<span><span class="co">#&gt;   })</span></span>
<span><span class="co">#&gt;   model({</span></span>
<span><span class="co">#&gt;     # Create the following one-hot encoded columns for previous and current Markov states (this can be done with `createMarkovModelDataset()`)</span></span>
<span><span class="co">#&gt;     # For state none: prevnone, curnone</span></span>
<span><span class="co">#&gt;     # For state mild: prevmild, curmild</span></span>
<span><span class="co">#&gt;     # For state moderate: prevmoderate, curmoderate</span></span>
<span><span class="co">#&gt;     # transition from state "none" to state "none"</span></span>
<span><span class="co">#&gt;     nonetonone &lt;- exp(lnonetonone)</span></span>
<span><span class="co">#&gt;     cumprnonetonone &lt;- expit(nonetonone)</span></span>
<span><span class="co">#&gt;     # transition from state "none" to state "mild"</span></span>
<span><span class="co">#&gt;     nonetomild &lt;- exp(lnonetomild)</span></span>
<span><span class="co">#&gt;     cumprnonetomild &lt;- expit(nonetonone + nonetomild)</span></span>
<span><span class="co">#&gt;     # transition from state "none" to state "moderate"</span></span>
<span><span class="co">#&gt;     cumprnonetomoderate &lt;- 1 # The final state has a cumulative probability of 1</span></span>
<span><span class="co">#&gt;     # Probability of each state transition</span></span>
<span><span class="co">#&gt;     prnonetonone &lt;- cumprnonetonone # Probability of transition from state none to none</span></span>
<span><span class="co">#&gt;     prnonetomild &lt;- cumprnonetomild - cumprnonetonone # Probability of transition from state none to mild</span></span>
<span><span class="co">#&gt;     prnonetomoderate &lt;- cumprnonetomoderate - cumprnonetomild # Probability of transition from state none to moderate</span></span>
<span><span class="co">#&gt;     # log-likelihood of any transition from state none</span></span>
<span><span class="co">#&gt;     llnone &lt;- prevnone*(curnone*log(prnonetonone) + curmild*log(prnonetomild) + curmoderate*log(prnonetomoderate))</span></span>
<span><span class="co">#&gt;     # transition from state "mild" to state "none"</span></span>
<span><span class="co">#&gt;     mildtonone &lt;- exp(lmildtonone)</span></span>
<span><span class="co">#&gt;     cumprmildtonone &lt;- expit(mildtonone)</span></span>
<span><span class="co">#&gt;     # transition from state "mild" to state "mild"</span></span>
<span><span class="co">#&gt;     mildtomild &lt;- exp(lmildtomild)</span></span>
<span><span class="co">#&gt;     cumprmildtomild &lt;- expit(mildtonone + mildtomild)</span></span>
<span><span class="co">#&gt;     # transition from state "mild" to state "moderate"</span></span>
<span><span class="co">#&gt;     cumprmildtomoderate &lt;- 1 # The final state has a cumulative probability of 1</span></span>
<span><span class="co">#&gt;     # Probability of each state transition</span></span>
<span><span class="co">#&gt;     prmildtonone &lt;- cumprmildtonone # Probability of transition from state mild to none</span></span>
<span><span class="co">#&gt;     prmildtomild &lt;- cumprmildtomild - cumprmildtonone # Probability of transition from state mild to mild</span></span>
<span><span class="co">#&gt;     prmildtomoderate &lt;- cumprmildtomoderate - cumprmildtomild # Probability of transition from state mild to moderate</span></span>
<span><span class="co">#&gt;     # log-likelihood of any transition from state mild</span></span>
<span><span class="co">#&gt;     llmild &lt;- prevmild*(curnone*log(prmildtonone) + curmild*log(prmildtomild) + curmoderate*log(prmildtomoderate))</span></span>
<span><span class="co">#&gt;     # transition from state "moderate" to state "none"</span></span>
<span><span class="co">#&gt;     moderatetonone &lt;- exp(lmoderatetonone)</span></span>
<span><span class="co">#&gt;     cumprmoderatetonone &lt;- expit(moderatetonone)</span></span>
<span><span class="co">#&gt;     # transition from state "moderate" to state "mild"</span></span>
<span><span class="co">#&gt;     moderatetomild &lt;- exp(lmoderatetomild)</span></span>
<span><span class="co">#&gt;     cumprmoderatetomild &lt;- expit(moderatetonone + moderatetomild)</span></span>
<span><span class="co">#&gt;     # transition from state "moderate" to state "moderate"</span></span>
<span><span class="co">#&gt;     cumprmoderatetomoderate &lt;- 1 # The final state has a cumulative probability of 1</span></span>
<span><span class="co">#&gt;     # Probability of each state transition</span></span>
<span><span class="co">#&gt;     prmoderatetonone &lt;- cumprmoderatetonone # Probability of transition from state moderate to none</span></span>
<span><span class="co">#&gt;     prmoderatetomild &lt;- cumprmoderatetomild - cumprmoderatetonone # Probability of transition from state moderate to mild</span></span>
<span><span class="co">#&gt;     prmoderatetomoderate &lt;- cumprmoderatetomoderate - cumprmoderatetomild # Probability of transition from state moderate to moderate</span></span>
<span><span class="co">#&gt;     # log-likelihood of any transition from state moderate</span></span>
<span><span class="co">#&gt;     llmoderate &lt;- prevmoderate*(curnone*log(prmoderatetonone) + curmild*log(prmoderatetomild) + curmoderate*log(prmoderatetomoderate))</span></span>
<span><span class="co">#&gt;     # Overall Markov model log-likelihood</span></span>
<span><span class="co">#&gt;     llMarkov &lt;- llnone + llmild + llmoderate</span></span>
<span><span class="co">#&gt;     ll(err) ~ llMarkov</span></span>
<span><span class="co">#&gt;   })</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>At this point, the model is a character string. Use advanced R
methods (with standard R functions) to convert that to a function for
<code>nlmixr2</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modFun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">str2lang</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The model can subsequently be modified the same as any other
<code>nlmixr2</code> model, for example to add drug effects, etc.</p>
</div>
<div class="section level2">
<h2 id="fit-the-model">Fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">nlmixr2est</span><span class="fu">::</span><span class="fu"><a href="https://nlmixr2.github.io/nlmixr2est/reference/nlmixr2.html" class="external-link">nlmixr</a></span><span class="op">(</span><span class="va">modFun</span>, data <span class="op">=</span> <span class="va">dMarkov</span>, est <span class="op">=</span> <span class="st">"focei"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>print <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> parameter labels from comments are typically ignored in non-interactive mode</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Need to run with the source intact to parse comments</span></span>
<span><span class="co">#&gt; → loading into <span style="color: #0000BB;">symengine</span> environment...</span></span>
<span><span class="co">#&gt; → pruning branches (`if`/`else`) of full model...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; → finding duplicate expressions in EBE model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → optimizing duplicate expressions in EBE model...</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00</span></span>
<span><span class="co">#&gt; → compiling EBE model...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="co">#&gt; rxode2 5.0.1 using 2 threads (see ?getRxThreads)</span></span>
<span><span class="co">#&gt;   no cache: create with `rxCreateCache()`</span></span>
<span><span class="co">#&gt; calculating covariance matrix</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:00 </span></span>
<span><span class="co">#&gt; done</span></span>
<span><span class="co">#&gt; → Calculating residuals/tables</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> done</span></span>
<span><span class="va">fit</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── </span><span style="color: #0000BB; font-weight: bold;">nlmix</span><span style="color: #BB0000; font-weight: bold;">r²</span><span style="font-weight: bold;"> log-likelihood </span><span style="color: #BBBB00; font-weight: bold;">Population Only</span><span style="font-weight: bold;"> (outer: nlminb) ──</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          OBJF      AIC      BIC Log-likelihood Condition#(Cov) Condition#(Cor)</span></span>
<span><span class="co">#&gt; lPop 62.32601 101.8942 106.1425      -44.94708         1.93075        1.000083</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Time (sec </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$time</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            setup optimize covariance table    other</span></span>
<span><span class="co">#&gt; elapsed 0.019889 0.002733   0.002734 0.036 2.947644</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── (</span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$parFixed</span><span style="font-weight: bold;"> or </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="color: #0000BB; font-weight: bold;">$parFixedDf</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                                                                                          <span style="font-weight: bold;">Parameter</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lnonetonone</span>                                           Probability of transition from state none to none (log-link)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lnonetomild</span>         Probability of transition from state none to mild (log-logit link difference from prior state)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lmildtonone</span>                                           Probability of transition from state mild to none (log-link)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lmildtomild</span>         Probability of transition from state mild to mild (log-logit link difference from prior state)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lmoderatetonone</span>                                   Probability of transition from state moderate to none (log-link)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lmoderatetomild</span> Probability of transition from state moderate to mild (log-logit link difference from prior state)</span></span>
<span><span class="co">#&gt;                   <span style="font-weight: bold;">Est.</span>     <span style="font-weight: bold;">SE</span> <span style="font-weight: bold;">%RSE</span> <span style="font-weight: bold;">Back-transformed(95%CI)</span> <span style="font-weight: bold;">BSV(SD)</span> <span style="font-weight: bold;">Shrink(SD)%</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lnonetonone</span>     -0.693 0.0184 2.65      0.5 (0.482, 0.518)                    </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lnonetomild</span>      0.511 0.0164 3.21       1.67 (1.61, 1.72)                    </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lmildtonone</span>       -1.1 0.0228 2.08    0.333 (0.319, 0.348)                    </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lmildtomild</span>      0.916 0.0208 2.27          2.5 (2.4, 2.6)                    </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lmoderatetonone</span>   -1.1 0.0228 2.08    0.333 (0.319, 0.348)                    </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">lmoderatetomild</span>  0.693 0.0184 2.65          2 (1.93, 2.07)                    </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;   Covariance Type (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$covMethod</span>): <span style="font-weight: bold;">r</span></span></span>
<span><span class="co">#&gt;   Information about run found (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$runInfo</span>):</span></span>
<span><span class="co">#&gt;    • gradient problems with initial estimate and covariance; see $scaleInfo </span></span>
<span><span class="co">#&gt;    • last objective function was not at minimum, possible problems in optimization </span></span>
<span><span class="co">#&gt;   Censoring (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$censInformation</span>): No censoring</span></span>
<span><span class="co">#&gt;   Minimization message (<span style="color: #BBBB00;">fit</span><span style="color: #0000BB; font-weight: bold;">$message</span>):  </span></span>
<span><span class="co">#&gt;     false convergence (8) </span></span>
<span><span class="co">#&gt;   In an ODE system, false convergence may mean "useless" evaluations were performed.</span></span>
<span><span class="co">#&gt;   See https://tinyurl.com/yyrrwkce</span></span>
<span><span class="co">#&gt;   It could also mean the convergence is poor, check results before accepting fit</span></span>
<span><span class="co">#&gt;   You may also try a good derivative free optimization:</span></span>
<span><span class="co">#&gt;     nlmixr2(...,control=list(outerOpt="bobyqa"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">── Fit Data (object </span><span style="color: #BBBB00; font-weight: bold;">fit</span><span style="font-weight: bold;"> is a modified </span><span style="color: #0000BB; font-weight: bold;">tibble</span><span style="font-weight: bold;">): ──</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 29</span></span></span>
<span><span class="co">#&gt;   ID     TIME    DV IPRED nonetonone cumprnonetonone nonetomild cumprnonetomild</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1         0     0 -<span style="color: #BB0000;">1.29</span>      0.500           0.622       1.67           0.897</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1         1     0 -<span style="color: #BB0000;">2.89</span>      0.500           0.622       1.67           0.897</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1         2     0 -<span style="color: #BB0000;">1.11</span>      0.500           0.622       1.67           0.897</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 21 more variables: prnonetonone &lt;dbl&gt;, prnonetomild &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   prnonetomoderate &lt;dbl&gt;, llnone &lt;dbl&gt;, mildtonone &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   cumprmildtonone &lt;dbl&gt;, mildtomild &lt;dbl&gt;, cumprmildtomild &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   prmildtonone &lt;dbl&gt;, prmildtomild &lt;dbl&gt;, prmildtomoderate &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   llmild &lt;dbl&gt;, moderatetonone &lt;dbl&gt;, cumprmoderatetonone &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   moderatetomild &lt;dbl&gt;, cumprmoderatetomild &lt;dbl&gt;, prmoderatetonone &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulate-your-data">Simulate your data<a class="anchor" aria-label="anchor" href="#simulate-your-data"></a>
</h2>
<p>To simulate from a Markov model, you first need to run a typical
simulation from the model to get probabilities of each state. Then,
post-process the simulation results to get the states.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dSim &lt;- nlmixr2est::vpcSim(fit, normRelated = FALSE)</span></span>
<span><span class="va">dSimRaw</span> <span class="op">&lt;-</span> <span class="fu">nlmixr2est</span><span class="fu">::</span><span class="fu"><a href="https://nlmixr2.github.io/nlmixr2est/reference/nlmixr2.html" class="external-link">nlmixr</a></span><span class="op">(</span><span class="va">fit</span>, est <span class="op">=</span> <span class="st">"rxSolve"</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nStud <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> use `data` from prior/supplied fit</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using population uncertainty from fitted model (`thetaMat`)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using `dfObs=15` from the number of observations in fitted model</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using `dfSub=0` from the number of subjects in fitted model</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using diagonal `sigma` based on model</span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): multi-subject simulation without without 'omega'</span></span>
<span><span class="va">dSim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simMarkov.html">simMarkov</a></span><span class="op">(</span><span class="va">dSimRaw</span>, states <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">markovStates</span>, initialState <span class="op">=</span> <span class="st">"none"</span>, colPrev <span class="op">=</span> <span class="st">"previous"</span>, colCur <span class="op">=</span> <span class="st">"current"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="summarize-the-simulations">Summarize the simulations<a class="anchor" aria-label="anchor" href="#summarize-the-simulations"></a>
</h3>
<p>Simulations can be plotted,</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dSim</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">current</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">sim.id</span>, <span class="va">id</span><span class="op">)</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">sim.id</span>, <span class="va">id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_count.html" class="external-link">geom_count</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="markov_files/figure-html/plot-simulation-1.png" class="r-plt" alt="" width="700"></p>
<p>tabulated,</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/createMarkovTransitionMatrix.html">createMarkovTransitionMatrix</a></span><span class="op">(</span>colPrev <span class="op">=</span> <span class="va">dMarkov</span><span class="op">$</span><span class="va">previous</span>, colCur <span class="op">=</span> <span class="va">dMarkov</span><span class="op">$</span><span class="va">current</span><span class="op">)</span></span>
<span><span class="co">#&gt;               none      mild  moderate</span></span>
<span><span class="co">#&gt; none     0.5000000 0.3333333 0.1666667</span></span>
<span><span class="co">#&gt; mild     0.3333333 0.5000000 0.1666667</span></span>
<span><span class="co">#&gt; moderate 0.3333333 0.3333333 0.3333333</span></span>
<span><span class="fu"><a href="../reference/createMarkovTransitionMatrix.html">createMarkovTransitionMatrix</a></span><span class="op">(</span>colPrev <span class="op">=</span> <span class="va">dSim</span><span class="op">$</span><span class="va">previous</span>, colCur <span class="op">=</span> <span class="va">dSim</span><span class="op">$</span><span class="va">current</span><span class="op">)</span></span>
<span><span class="co">#&gt;               none      mild   moderate</span></span>
<span><span class="co">#&gt; none     0.6666667 0.2407407 0.09259259</span></span>
<span><span class="co">#&gt; mild     0.6875000 0.3125000 0.00000000</span></span>
<span><span class="co">#&gt; moderate 0.6000000 0.2000000 0.20000000</span></span></code></pre></div>
<p>or summarized in any other useful way.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Richard Hooijmaijers, Matthew Fidler, Bill Denney, Kiranmayi Vedantham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
